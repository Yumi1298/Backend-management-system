<%- include("../parts/html-head") %> <%- include("../parts/navbar") %>
<style>
  .required {
    color: red;
  }

  .form-text {
    color: red;
  }
</style>
<div id="layoutSidenav">
  <%- include("../parts/layout-sidenav") %>
  <div id="layoutSidenav_content">
    <main>
      <div class="container-fluid px-4">
        <h1 class="mt-4">編輯資料</h1>
        <div class="row my-3">
          <div class="col-6">
            <div class="card">
              <div class="card-body">
                <form name="form1" onsubmit="sendData(event)">
                  <div class="mb-3">
                    <label for="name" class="form-label">編號</label>
                    <input
                      type="text"
                      class="form-control"
                      value="<%= sid %>"
                      disabled
                    />
                  </div>
                  <div class="mb-3">
                    <label for="name" class="form-label"
                      ><span class="required">**</span> 姓名</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="name"
                      name="name"
                      value="<%= name %>"
                    />
                    <div class="form-text"></div>
                  </div>

                  <div class="mb-3">
                    <label for="birthday" class="form-label">生日</label>
                    <input
                      type="date"
                      class="form-control"
                      id="birthday"
                      name="birthday"
                      value="<%= birthday %>"
                    />
                    <div class="form-text"></div>
                  </div>

                  <div class="mb-3">
                    <label for="mobile" class="form-label">手機號碼</label>
                    <input
                      type="text"
                      class="form-control"
                      id="mobile"
                      name="mobile"
                      value="<%= mobile %>"
                    />
                    <div class="form-text"></div>
                  </div>

                  <div class="mb-3">
                    <label for="product_id" class="form-label">產品序號</label>
                    <input
                      class="form-control"
                      id="product_id"
                      name="product_id"
                      rows="3"
                      value="<%= product_id %>"
                    ></input>
                    <div class="form-text"></div>
                  </div>

                  <div class="mb-3">
                    <label for="purchase_date" class="form-label"
                      >購買日期</label
                    >
                    <input
                      type="date"
                      class="form-control"
                      id="purchase_date"
                      name="purchase_date"
                      value="<%= purchase_date %>"
                    />
                    <div class="form-text"></div>
                  </div>

                  <div class="mb-3">
                    <label for="purchase_source" class="form-label"
                      >購買來源</label
                    >
                    <select id="purchase_source" name="purchase_source" class="form-select" >
                      <option>---請選擇購買來源---</option>
                      <option value="網路購買" <%= purchase_source === '網路購買' ? 'selected' : '' %>>網路購買</option>
                      <option value="實體店面" <%= purchase_source === '實體店面' ? 'selected' : '' %>>實體店面</option>
                      <option value="其他" <%= purchase_source === '其他' ? 'selected' : '' %>>其他</option>
                    </select>
                    
                    <div class="form-text"></div>
                  </div>

                  <button type="submit" class="btn btn-primary">修改</button>
                  <a href="/user" class="btn btn-secondary">到列表頁</a>

                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="exampleModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">資料修改結果</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-success" role="alert">資料修改成功</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          繼續修改
        </button>
        <a href="/user" class="btn btn-primary">到列表頁</a>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="exampleModal2"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel2">資料修改結果</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger" role="alert">資料沒有修改</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          繼續修改
        </button>
        <a href="/user" class="btn btn-primary">到列表頁</a>
      </div>
    </div>
  </div>
</div>
<%- include("../parts/scripts") %>
<script>
  const nameField = document.form1.name;


  const sendData = (e) => {
    e.preventDefault();

    // 回復沒有提示的狀態
    nameField.style.border = "1px solid #CCCCCC";
    nameField.nextElementSibling.innerHTML = "";
  

    let isPass = true; // 有沒有通過檢查

    // TODO: 要做欄位資料檢查
    if (nameField.value.length < 2) {
      isPass = false;
      // 跳提示用戶
      nameField.style.border = "1px solid red";
      nameField.nextElementSibling.innerHTML = "請填寫正確的姓名";
    }



    // 如果欄位資料都有通過檢查
    if (isPass) {
      const fd = new FormData(document.form1); // 建立一個只有資料的表單物件

      fetch("", {
        method: "PUT",
        body: fd, // 預設的 Content-Type: multipart/form-data
      })
        .then((r) => r.json())
        .then((data) => {
          console.log(data);
          if (data.success) {
            myModal.show();
          } else {
            myModal2.show();
          }
        })
        .catch((ex) => {
          console.log(`fetch() 發生錯誤, 回傳的 JSON 格式是錯的`);
          console.log(ex);
        });
    }
  };

  const myModal = new bootstrap.Modal("#exampleModal");
  const myModal2 = new bootstrap.Modal("#exampleModal2");
</script>
<%- include("../parts/html-foot") %>
